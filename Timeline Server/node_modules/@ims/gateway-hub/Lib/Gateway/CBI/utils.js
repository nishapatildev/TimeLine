/* ********************************************************************************* */
const communication = require('../../CommType/communication.js');
const errModule     = require('../../../Utils/error');
const url 			= require('url');
/* ********************************************************************************* */
module.exports= function w_communication(transXpedia) {
	return new Promise((resolved, rejected) => {
		try {			
			transXpedia.rejectUnauthorized = false;
			transXpedia.header 				= {
					"content-type"				: "application/json",
			}
            let talkToServer = communication[url.parse(transXpedia.clientData.gatewayUrl).protocol.slice(0,-1).toUpperCase()];// need to do url.parse
			talkToServer(transXpedia)
				.then((transXpedia) => {
					return resolved(transXpedia);
				}).catch((transXpedia) => {
					return rejected(transXpedia.errorData);
				})

		} catch(e) {
			transXpedia.errorData.systemErr      = e;
			transXpedia.errorData.serverError    = errModule.E_GATEWAY_META_COMM_DATA;
			transXpedia.errorData.errDescription = `UNABLE TO GET GATEWAY CREDENTIALS`;
			return rejected(transXpedia.errorData);
		}
	});
}

/* ********************************************************************************* */
